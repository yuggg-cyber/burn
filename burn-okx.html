<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Solana Token Viewer with Symbol</title>
</head>
<body style="background:#0b0b0b;color:#cce8cc;font-family:monospace;padding:16px;">
  <h2>ðŸ”¥ Solana Token Viewer (OKX & Phantom)</h2>
  <button id="connectBtn">è¿žæŽ¥é’±åŒ…</button>
  <span id="wallet">æœªè¿žæŽ¥</span>
  <div id="token-list"></div>
  <pre id="log"></pre>

  <script type="module">
    import { Connection, PublicKey } from "https://esm.sh/@solana/web3.js";
    import { TOKEN_PROGRAM_ID } from "https://esm.sh/@solana/spl-token";
    import { TokenListProvider, ENV } from "https://esm.sh/@solana/spl-token-registry";

    const connection = new Connection("https://rpc.ankr.com/solana");
    let provider = null;
    let pubkey = null;
    let tokenMap = new Map();

    async function loadTokenRegistry() {
      const tokens = await new TokenListProvider().resolve();
      const tokenList = tokens.filterByChainId(ENV.MainnetBeta).getList();
      tokenList.forEach(t => tokenMap.set(t.address, t));
    }

    function getProvider() {
      if (window.okxwallet?.solana) return window.okxwallet.solana; // OKX
      if (window.phantom?.solana) return window.phantom.solana;     // Phantom
      if (window.solana?.isPhantom) return window.solana;           // æ—§ç‰ˆ Phantom
      return null;
    }

    function log(msg) {
      document.getElementById("log").textContent += msg + "\n";
    }

    document.getElementById("connectBtn").onclick = async () => {
      provider = getProvider();
      if (!provider) {
        log("æ²¡æœ‰æ£€æµ‹åˆ° OKX æˆ– Phantom é’±åŒ…æ’ä»¶ï¼");
        return;
      }
      try {
        const resp = await provider.connect();
        pubkey = resp.publicKey;
        document.getElementById("wallet").textContent = pubkey.toBase58();
        log("å·²è¿žæŽ¥é’±åŒ…: " + pubkey.toBase58());
        await loadTokenRegistry();
        await loadTokens();
      } catch (e) {
        log("è¿žæŽ¥å¤±è´¥: " + e.message);
      }
    };

    async function loadTokens() {
      const resp = await connection.getParsedTokenAccountsByOwner(pubkey, { programId: TOKEN_PROGRAM_ID });
      const listDiv = document.getElementById("token-list");
      listDiv.innerHTML = "";

      for (const { account } of resp.value) {
        const info = account.data.parsed.info;
        const mint = info.mint;
        const amount = info.tokenAmount.uiAmount;

        if (amount > 0) {
          let symbol = "N/A";
          if (tokenMap.has(mint)) {
            symbol = tokenMap.get(mint).symbol;
          }
          const div = document.createElement("div");
          div.textContent = `Mint: ${mint} | Symbol: ${symbol} | Amount: ${amount}`;
          listDiv.appendChild(div);
        }
      }
    }
  </script>
</body>
</html>
